<!DOCTYPE html>
<html>
	<head>
		<title>ParseTime Tests</title>
		<meta charset="utf-8">
		<style type="text/css">
			div.testResult {
				white-space: pre-wrap;
				font-size: 14px;
				width: 500px;
				font-family: "Inconsolata", "Consolas", "Lucida Console", "Bitstream Vera Sans Mono", monospace;
			}
			
			div.testResult.passed {
				background-color: #aaeeaa;
			}
			
			div.testResult.failed {
				background-color: #ee7777;
			}
		</style>
		<script src="../lib/parseTime.js"></script>
	</head>
	<body>
		<script>
			var tests = [
				['1:32 AM', '1:32 AM'],
				['1', '1:00 AM'],
				['01', '1:00 AM'],
				['0132', '1:32 AM'],
				['132', '1:32 AM'],
				['1:32', '1:32 AM'],
				['1:32p', '1:32 PM'],
				['1p', '1:00 PM'],
				['1:32pm', '1:32 PM'],
				['1:32 pm', '1:32 PM'],
				['1:32 PM', '1:32 PM'],
				['1:32 p.m.', '1:32 PM'],
				['01:32 PM', '1:32 PM'],
				['1332', '1:32 PM'],
				['13:32', '1:32 PM'],
				['13', '1:00 PM'],
				['1 p', '1:00 PM'],
				['1p', '1:00 PM'],
				['1.32p', '1:32 PM'],
				['1 32p', '1:32 PM'],
				['1;32p', '1:32 PM'],
				['1$32p', '1:32 PM'],
				['1  32p', '1:32 PM'],
				['1\t32p', '1:32 PM'],
				['  1  32  p  ', '1:32 PM'],
				['0:00', '12:00 AM'],
				['0:32', '12:32 AM'],
				['12:00', '12:00 PM'],
				['12:00 PM', '12:00 PM'],
				['12:00 AM', '12:00 AM'],
				['1200', '12:00 PM'],
				['11:00', '11:00 AM'],
				['1100', '11:00 AM'],
				['11:00 AM', '11:00 AM'],
				['11:00 PM', '11:00 PM'],
				['23:00', '11:00 PM'],
				['23:59', '11:59 PM'],
				
				['24:00', '(invalid Date)'],
				['2400', '(invalid Date)'],
				['13:60', '(invalid Date)'],
				['13:61', '(invalid Date)'],
				['24:01', '(invalid Date)'],
				[':01', '(invalid Date)'],
				[':', '(invalid Date)'],
				['13:00AM', '(invalid Date)'],
				['x1:00 PMx', '(invalid Date)'],
				
				['', 'null'],
				['   ', 'null'],
				[null, 'null'],
				[undefined, 'null'],
			];
		
			var allTestsPassed = true;
			var message = "Tests Complete";
			try {
				tests.forEach(function(test) {
					var testPassed = printResult(test[0], test[1], runTest(test[0]));
					allTestsPassed = allTestsPassed && testPassed;
				});
			}
			catch (ex) {
				allTestsPassed = false;
				message = "Error: " + ex.message;
			}
			document.write('<br/><div class="testResult ' + (allTestsPassed ? 'passed' : 'failed') + '">' + message + '</div>');
			
			function runTest(input) {
				var result = parseTime(input);
				
				if (result === null) {
					return 'null'
				} else if (isInvalidDate(result)) {
					return ('(invalid Date)');
				} else if (isValidDate(result) && result.getFullYear() == 1970 && result.getMonth() == 0 && result.getDate() == 1 && result.getMilliseconds() == 0) {
					return convertTimeToString(result);
				} else {
					throw new Error('Unexpected result');
				}
			}
			
			function convertTimeToString(date) {
				var hours = date.getHours();
				var minutes = date.getMinutes();
				var minuteString = minutes > 9 ? minutes.toString() : '0' + minutes.toString();
				
				if (hours > 12) {
					return (hours - 12) + ':' + minuteString + ' PM';
				} else if (hours == 0) {
				 	return 12 + ':' + minuteString + ' AM';
				} else if (hours == 12) {
					return 12 + ':' + minuteString + ' PM';
				} else {
					return hours + ':' + minuteString + ' AM';
				}	
			}
			
			function printResult(input, expectedResult, actualResult) {
				var testPassed = expectedResult === actualResult;
				
				document.write('<div class="testResult ' + (testPassed ? 'passed' : 'failed') + '">' + convertValueToHtml(input) + ' -&gt; ' + convertValueToHtml(expectedResult) +
					' | ' + (testPassed ? 'PASSED' : 'FAILED - Got: ' + convertValueToHtml(actualResult)) + '</div>');
					
				return testPassed;
			}
			
			function convertValueToHtml(value) {
				if (value === null) {
					return 'null';
				} else if (value === undefined) {
					return 'undefined';
				} else {
					return escapeXml(value.toString());
				}
			}
		
			ï»¿// Escapes special characters in a string using XML escape sequences.
			function escapeXml(str) {
				return str.replace("&", "&amp;"). // replace ampersand first
				replace("<", "&lt;").
				replace(">", "&gt;").
				replace("\"", "&quot;").
				replace("'", "&#39;");
			}
			
		</script>
	</body>
</html>